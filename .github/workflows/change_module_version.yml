name: Change module version

on:
  push:
    branches:
      - main

jobs:
  change_module_version:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2
      
    - name: Setup Git Config
      run: |
      
        # Setup the username and email.
        git config user.name "GitHub Actions Bot"
        git config user.email "<>"
          
    - name: Change Module Version
      run: |
      
        previous_commit=$(git rev-parse origin/main^1)
        # Find all first level folders in repository 
        directories_to_modify=$(find . -maxdepth 1 -type d -not -name ".*")
        for dir in $directories_to_modify; do
          cd "${dir:2}"
          echo "${dir:2}"
          if git diff --exit-code --quiet $previous_commit -- "${dir:2}"; then
            echo "no"
          else
            echo "${dir:2}"
          fi
          # Return to the original directory
          cd ..
        done

      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}