name: Change module version

on:
  push:
    branches:
      - main

jobs:
  change_module_version:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with: 
          fetch-depth: 0
      - name: Get changed directories
        id: get-changes
        run: |

          changed_files=$(git diff --name-only ${{ github.event.before }} ${{ github.sha }})
          
          changed_directories=()
          for file in $changed_files; do
            echo "$file"
            if [[ "${file}" == .* ]]; then
              echo "skip"
              continue
            fi

            # Split value by /
            IFS='/' read -ra parts <<< "$file"

            # Get the first component as modified value
            modified_value="${parts[0]}"
            echo "$modified_value"
            # Check if the modified value is not already in the list
            if [[ ! " $changed_directories " =~ " $modified_value " ]]; then
                # Add the modified value to the list
                changed_directories+=("${modified_value}")
            fi

          done
          echo "Modified and Unique Values $changed_directories"

          # # Find all first level folders in repository 
          # directories_to_modify=$(find . -maxdepth 1 -type d -not -name ".*")
          # for dir in $directories_to_modify; do
          #   cd "${dir:2}"
          #   echo "${dir:2}"
          #   # Get the second-to-last commit hash for the directory
          #   previous_commit=$(git rev-list -n 2 HEAD -- "${dir:2}" | tail -n 1)
            
          #   # Check if the directory has been modified
          #   if git diff --exit-code --quiet $previous_commit -- "${dir:2}"; then
          #     echo "no"
          #   else
          #     echo "${dir:2}"
          #   fi
          #   # Return to the original directory
          #   cd ..
          # done


        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}